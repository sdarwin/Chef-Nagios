# Generated by Chef
# host definitions

define host {
  use server
  address <%= node['ipaddress'] %>
  host_name <%= node['hostname'] %>
  hostgroups <%= node['nagios']['server_role'] %>
}

<% @nodes.each do |n| -%>
<% unless n.name == node.name -%>
define host {
  use server
  <% # decide whether to use internal or external IP addresses for this node
  # if the nagios server is not in the cloud, always use public IP addresses for cloud nodes.
  # if the nagios server is in the cloud, use private IP addresses for any
  #   cloud servers in the same cloud, public IPs for servers in other clouds
  #   (where other is defined by node['cloud']['provider']
  if node['cloud'].nil? && !n['cloud'].nil?
    ip = n['cloud']['public_ipv4']
  elsif !node['cloud'].nil? && n['cloud']['provider'] != node['cloud']['provider']
    ip = n['cloud']['public_ipv4']
       #S.D. 2013, 2 lines
  elsif !node['cloud'].nil? && n['ec2']['placement_availability_zone'][0..5] != node['ec2']['placement_availability_zone'][0..5]
    ip = n['cloud']['public_ipv4']
  else
    ip = n['ipaddress']
  end %>
  address <%= ip %>
  host_name <%= n['hostname'] %>
<% if n.run_list.roles.nil? || n.run_list.roles.length == 0 -%>
  hostgroups all
<% else -%>
  hostgroups <%= n.run_list.roles.to_a.join(",") %>
<% end -%>
}
<% end -%>

<% end -%>
